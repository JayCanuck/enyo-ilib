var ilib=require("./ilib.js");var Utils=require("./Utils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var CType=require("./CType.js");var isDigit=require("./isDigit.js");var isSpace=require("./isSpace.js");var Currency=require("./Currency.js");var INumber=function(str,options){var i,stripped="",sync=true,loadParams,onLoad;this.locale=new Locale();this.type="number";if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(options.type){switch(options.type){case"number":case"currency":case"percentage":this.type=options.type;break;default:break}}if(typeof options.sync!=="undefined"){sync=options.sync==true}loadParams=options.loadParams;onLoad=options.onLoad}isDigit._init(sync,loadParams,ilib.bind(this,function(){isSpace._init(sync,loadParams,ilib.bind(this,function(){new LocaleInfo(this.locale,{sync:sync,onLoad:ilib.bind(this,function(li){this.decimal=li.getDecimalSeparator();switch(typeof str){case"string":var unary=true;var lastNumericChar=0;this.str=str||"0";i=0;for(i=0;i<this.str.length;i++){if(unary&&this.str.charAt(i)==="-"){unary=false;stripped+=this.str.charAt(i);lastNumericChar=i}else if(isDigit(this.str.charAt(i))){stripped+=this.str.charAt(i);unary=false;lastNumericChar=i}else if(this.str.charAt(i)===this.decimal){stripped+=".";unary=false;lastNumericChar=i}}this.parsed=this.str.substring(0,lastNumericChar+1);this.value=parseFloat(stripped);break;case"number":this.str=""+str;this.value=str;break;case"object":this.value=str.valueOf();this.str=""+this.value;break;case"undefined":this.value=0;this.str="0";break}switch(this.type){default:break;case"percentage":if(this.str.indexOf(li.getPercentageSymbol())!==-1){this.value/=100}break;case"currency":stripped="";i=0;while(i<this.str.length&&!isDigit(this.str.charAt(i))&&!isSpace(this.str.charAt(i))){stripped+=this.str.charAt(i++)}if(stripped.length===0){while(i<this.str.length&&isDigit(this.str.charAt(i))||isSpace(this.str.charAt(i))||this.str.charAt(i)==="."||this.str.charAt(i)===","){i++}while(i<this.str.length&&!isDigit(this.str.charAt(i))&&!isSpace(this.str.charAt(i))){stripped+=this.str.charAt(i++)}}new Currency({locale:this.locale,sign:stripped,sync:sync,onLoad:ilib.bind(this,function(cur){this.currency=cur;if(options&&typeof options.onLoad==="function"){options.onLoad(this)}})});return}if(options&&typeof options.onLoad==="function"){options.onLoad(this)}})})}))}))};INumber.prototype={getLocale:function(){return this.locale},toString:function(){return this.str},getCurrency:function(){return this.currency},valueOf:function(){return this.value}};module.exports=INumber;