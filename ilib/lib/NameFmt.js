var ilib=require("./ilib.js");var Utils=require("./Utils.js");var Locale=require("./Locale.js");var IString=require("./IString.js");var Name=require("./Name.js");var CType=require("./CType.js");var isPunct=require("./isPunct.js");var NameFmt=function(options){var sync=true;this.style="short";this.loadParams={};if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(options.style){this.style=options.style}if(options.components){this.components=options.components}if(typeof options.sync!=="undefined"){sync=options.sync==true}if(typeof options.loadParams!=="undefined"){this.loadParams=options.loadParams}}this.defaultEuroTemplate=new IString("{prefix} {givenName} {middleName} {familyName}{suffix}");this.defaultAsianTemplate=new IString("{prefix}{familyName}{givenName}{middleName}{suffix}");this.useFirstFamilyName=false;switch(this.style){default:case"s":case"short":this.style="short";break;case"m":case"medium":this.style="medium";break;case"l":case"long":this.style="long";break;case"f":case"full":this.style="full";break}if(!Name.cache){Name.cache={}}this.locale=this.locale||new Locale();isPunct._init(sync,this.loadParams,ilib.bind(this,function(){Utils.loadData({object:Name,locale:this.locale,name:"name.json",sync:sync,loadParams:this.loadParams,callback:ilib.bind(this,function(info){if(!info){info=Name.defaultInfo;var spec=this.locale.getSpec().replace(/-/g,"_");Name.cache[spec]=info}this.info=info;this._init();if(options&&typeof options.onLoad==="function"){options.onLoad(this)}})})}))};NameFmt.prototype={_init:function(){if(this.components){var valids={p:1,g:1,m:1,f:1,s:1},arr=this.components.split("");this.comps={};for(var i=0;i<arr.length;i++){if(valids[arr[i].toLowerCase()]){this.comps[arr[i].toLowerCase()]=true}}}else{this.comps=this.info.components[this.style]}this.template=new IString(this.info.format);if(this.locale.language==="es"&&(this.style!=="long"&&this.style!=="full")){this.useFirstFamilyName=true}this.isAsianLocale=this.info.nameStyle==="asian"},_adjoinAuxillaries:function(parts,namePrefix){var start,i,prefixArray,prefix,prefixLower;if(this.info.auxillaries&&(parts.length>2||namePrefix)){for(start=0;start<parts.length-1;start++){for(i=parts.length;i>start;i--){prefixArray=parts.slice(start,i);prefix=prefixArray.join(" ");prefixLower=prefix.toLowerCase();prefixLower=prefixLower.replace(/[,\.]/g,"");if(prefixLower in this.info.auxillaries){parts.splice(start,i+1-start,prefixArray.concat(parts[i]));i=start}}}}return parts},getLocale:function(){return this.locale},getStyle:function(){return this.style},getComponents:function(){return this.components},format:function(name){var formatted,temp,modified,isAsianName;var currentLanguage=this.locale.getLanguage();if(!name||typeof name!=="object"){return undefined}if(typeof name.isAsianName==="boolean"&&!name.isAsianName||Name._isEuroName([name.givenName,name.middleName,name.familyName].join(""),currentLanguage)){isAsianName=false;modified=name.clone();if(modified.suffix&&isPunct(modified.suffix.charAt(0))===false){modified.suffix=" "+modified.suffix}if(this.useFirstFamilyName&&name.familyName){var familyNameParts=modified.familyName.trim().split(" ");if(familyNameParts.length>1){familyNameParts=this._adjoinAuxillaries(familyNameParts,name.prefix)}modified.familyName=familyNameParts[0]}modified._joinNameArrays()}else{isAsianName=true;modified=name;if(modified.suffix&&currentLanguage==="ko"&&this.info.honorifics.indexOf(name.suffix)==-1){modified.suffix=" "+modified.suffix}}if(!this.template||isAsianName!==this.isAsianLocale){temp=isAsianName?this.defaultAsianTemplate:this.defaultEuroTemplate}else{temp=this.template}var parts={prefix:this.comps["p"]&&modified.prefix||"",givenName:this.comps["g"]&&modified.givenName||"",middleName:this.comps["m"]&&modified.middleName||"",familyName:this.comps["f"]&&modified.familyName||"",suffix:this.comps["s"]&&modified.suffix||""};formatted=temp.format(parts);return formatted.replace(/\s+/g," ").trim()}};module.exports=NameFmt;