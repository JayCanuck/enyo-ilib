var PhoneHandler=function(){return this};PhoneHandler.prototype={processSubscriberNumber:function(number,fields,regionSettings){var last;last=number.search(/[xwtp,;]/i);if(last>-1){if(last>0){fields.subscriberNumber=number.substring(0,last)}fields.extension=number.substring(last).replace("x","")}else{if(number.length){fields.subscriberNumber=number}}if(regionSettings.plan.getFieldLength("maxLocalLength")&&fields.subscriberNumber&&fields.subscriberNumber.length>regionSettings.plan.getFieldLength("maxLocalLength")){fields.invalid=true}},processFieldWithSubscriberNumber:function(fieldName,length,number,currentChar,fields,regionSettings,noExtractTrunk){var ret,end;if(length!==undefined&&length>0){end=length;if(regionSettings.plan.getTrunkCode()==="0"&&number.charAt(0)==="0"){end+=regionSettings.plan.getTrunkCode().length}}else{end=currentChar+1-length}if(fields[fieldName]!==undefined){this.processSubscriberNumber(number,fields,regionSettings)}else{fields[fieldName]=number.substring(0,end);if(number.length>end){this.processSubscriberNumber(number.substring(end),fields,regionSettings)}}ret={number:""};return ret},processField:function(fieldName,length,number,currentChar,fields,regionSettings){var ret={},end;if(length!==undefined&&length>0){end=length;if(regionSettings.plan.getTrunkCode()==="0"&&number.charAt(0)==="0"){end+=regionSettings.plan.getTrunkCode().length}}else{end=currentChar+1-length}if(fields[fieldName]!==undefined){this.processSubscriberNumber(number,fields,regionSettings);ret.number=""}else{fields[fieldName]=number.substring(0,end);ret.number=number.length>end?number.substring(end):""}return ret},trunk:function(number,currentChar,fields,regionSettings){var ret,trunkLength;if(fields.trunkAccess!==undefined){this.processSubscriberNumber(number,fields,regionSettings);number=""}else{trunkLength=regionSettings.plan.getTrunkCode().length;fields.trunkAccess=number.substring(0,trunkLength);number=number.length>trunkLength?number.substring(trunkLength):""}ret={number:number};return ret},plus:function(number,currentChar,fields,regionSettings){var ret={};if(fields.iddPrefix!==undefined){this.processSubscriberNumber(number,fields,regionSettings);ret.number=""}else{fields.iddPrefix=number.substring(0,1);ret={number:number.substring(1),table:"idd"}}return ret},idd:function(number,currentChar,fields,regionSettings){var ret={};if(fields.iddPrefix!==undefined){this.processSubscriberNumber(number,fields,regionSettings);ret.number=""}else{fields.iddPrefix=number.substring(0,currentChar+1);ret={number:number.substring(currentChar+1),table:"idd"}}return ret},country:function(number,currentChar,fields,regionSettings){var ret,cc;fields.countryCode=number.substring(0,currentChar+1);cc=fields.countryCode.replace(/[wWpPtT\+#\*]/g,"");ret={number:number.substring(currentChar+1),countryCode:cc};return ret},cic:function(number,currentChar,fields,regionSettings){return this.processField("cic",regionSettings.plan.getFieldLength("cic"),number,currentChar,fields,regionSettings)},service:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("serviceCode"),number,currentChar,fields,regionSettings,false)},area:function(number,currentChar,fields,regionSettings){var ret,last,end,localLength;last=number.search(/[xwtp]/i);localLength=last>-1?last:number.length;if(regionSettings.plan.getFieldLength("areaCode")>0){end=regionSettings.plan.getFieldLength("areaCode");if(regionSettings.plan.getTrunkCode()===number.charAt(0)){end+=regionSettings.plan.getTrunkCode().length;localLength-=regionSettings.plan.getTrunkCode().length}}else{end=currentChar+1-regionSettings.plan.getFieldLength("areaCode")}if(regionSettings.plan.getFieldLength("maxLocalLength")!==undefined){if(fields.trunkAccess!==undefined||fields.mobilePrefix!==undefined||fields.countryCode!==undefined||localLength>regionSettings.plan.getFieldLength("maxLocalLength")){fields.areaCode=number.substring(0,end);if(number.length>end){this.processSubscriberNumber(number.substring(end),fields,regionSettings)}}else{this.processSubscriberNumber(number,fields,regionSettings)}}else{fields.areaCode=number.substring(0,end);if(number.length>end){this.processSubscriberNumber(number.substring(end),fields,regionSettings)}}if(regionSettings.plan.getFindExtensions()!==undefined&&fields.subscriberNumber!==undefined){var dash=fields.subscriberNumber.indexOf("-");if(dash>-1){fields.subscriberNumber=fields.subscriberNumber.substring(0,dash);fields.extension=fields.subscriberNumber.substring(dash+1)}}ret={number:""};return ret},none:function(number,currentChar,fields,regionSettings){var ret;if(number.length>0){this.processSubscriberNumber(number,fields,regionSettings);if(currentChar>0&&currentChar<number.length){fields.invalid=true}}ret={number:""};return ret},vsc:function(number,currentChar,fields,regionSettings){var ret,length,end;if(fields.vsc===undefined){length=regionSettings.plan.getFieldLength("vsc")||0;if(length!==undefined&&length>0){end=length}else{end=currentChar+1-length}fields.vsc=number.substring(0,end);number=number.length>end?"^"+number.substring(end):""}else{this.processSubscriberNumber(number,fields,regionSettings);number=""}ret={number:number};return ret},cell:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("mobilePrefix",regionSettings.plan.getFieldLength("mobilePrefix"),number,currentChar,fields,regionSettings,false)},personal:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("personal"),number,currentChar,fields,regionSettings,false)},emergency:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("emergency",regionSettings.plan.getFieldLength("emergency"),number,currentChar,fields,regionSettings,true)},premium:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("premium"),number,currentChar,fields,regionSettings,false)},special:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("special"),number,currentChar,fields,regionSettings,false)},service2:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("service2"),number,currentChar,fields,regionSettings,false)},service3:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("service3"),number,currentChar,fields,regionSettings,false)},service4:function(number,currentChar,fields,regionSettings){return this.processFieldWithSubscriberNumber("serviceCode",regionSettings.plan.getFieldLength("service4"),number,currentChar,fields,regionSettings,false)},cic2:function(number,currentChar,fields,regionSettings){return this.processField("cic",regionSettings.plan.getFieldLength("cic2"),number,currentChar,fields,regionSettings)},cic3:function(number,currentChar,fields,regionSettings){return this.processField("cic",regionSettings.plan.getFieldLength("cic3"),number,currentChar,fields,regionSettings)},start:function(number,currentChar,fields,regionSettings){return{number:number}},local:function(number,currentChar,fields,regionSettings){this.processSubscriberNumber(number,fields,regionSettings);return{number:""}}};var CSStateHandler=function(){return this};CSStateHandler.prototype=new PhoneHandler();CSStateHandler.prototype.special=function(number,currentChar,fields,regionSettings){var ret;if(number.charAt(0)==="0"){fields.trunkAccess=number.charAt(0);fields.areaCode=number.substring(1,currentChar)}else{fields.areaCode=number.substring(0,currentChar)}this.processSubscriberNumber(number.substring(currentChar),fields,regionSettings);ret={number:""};return ret};var USStateHandler=function(){return this};USStateHandler.prototype=new PhoneHandler();USStateHandler.prototype.vsc=function(number,currentChar,fields,regionSettings){var ret;fields.vsc=number;ret={number:""};return ret};var PhoneHandlerFactory=function(locale,plan){if(plan.getContextFree()!==undefined&&typeof plan.getContextFree()==="boolean"&&plan.getContextFree()===false){return new CSStateHandler();}var region=locale&&locale.getRegion()||"ZZ";switch(region){case"US":return new USStateHandler();break;default:return new PhoneHandler();}};module.exports=PhoneHandlerFactory;