module.exports=function(ilib){var path=require("./Path.js"),fs=require("fs"),util=require("util"),ZoneInfoFile=require("./ZoneInfo.js"),Loader=require("./Loader.js");var NodeLoader=function(ilib){this.parent.call(this,ilib);this.root=process.cwd();this.base=typeof module!=="undefined"&&module.filename?path.join(path.dirname(module.filename),".."):this.root;this.includePath.push(path.join(this.root,"resources"));this._exists(path.join(this.base,"locale"),"localeinfo.json");this._exists("/usr/share/javascript/ilib/locale","localeinfo.json");if(fs.existsSync("/usr/share/zoneinfo")){this.useSystemZoneInfo=false}else{}};NodeLoader.prototype=new Loader();NodeLoader.prototype.parent=Loader;NodeLoader.prototype.constructor=NodeLoader;NodeLoader.prototype.name="NodeLoader";NodeLoader.prototype._loadFile=function(pathname,sync,cb){var text;try{if(this.useSystemZoneInfo&&pathname.indexOf("zoneinfo")!==-1){text=this._createZoneFile(pathname)}else text=fs.readFileSync(pathname,"utf-8");if(typeof cb==="function"){cb(text)}}catch(e){if(typeof cb==="function"){cb()}}return text};NodeLoader.prototype._createZoneFile=function(path){var zone=path.substring(path.indexOf("zoneinfo"));zone=zone.substring(0,zone.length-5);try{var zif=new ZoneInfoFile("/usr/share/"+zone);ret=zif.getIlibZoneInfo(new Date);return JSON.stringify(ret)}catch(e){console.log("NodeLoader._createZoneFile: error: "+e);return undefined}};NodeLoader.prototype._exists=function(dir,file){var fullpath=path.normalize(path.join(dir,file));if(fs.existsSync(fullpath)){this.includePath.push(dir)}};return new NodeLoader(ilib)};