var ilib=require("./ilib.js");var Utils=require("./Utils.js");var JSUtils=require("./JSUtils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var DateFmt=require("./DateFmt.js");var IString=require("./IString.js");var ResBundle=require("./ResBundle.js");var DurationFmt=function(options){var sync=true;var loadParams=undefined;this.locale=new Locale();this.length="short";this.style="text";if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(options.length){if(options.length==="short"||options.length==="medium"||options.length==="long"||options.length==="full"){this.length=options.length}}if(options.style){if(options.style==="text"||options.style==="clock"){this.style=options.style}}if(typeof options.sync!=="undefined"){sync=options.sync==true}if(typeof options.useNative==="boolean"){this.useNative=options.useNative}loadParams=options.loadParams}new ResBundle({locale:this.locale,name:"sysres",sync:sync,loadParams:loadParams,onLoad:ilib.bind(this,function(sysres){switch(this.length){case"short":this.components={year:sysres.getString("#{num}y"),month:sysres.getString("#{num}m","durationShortMonths"),week:sysres.getString("#{num}w"),day:sysres.getString("#{num}d"),hour:sysres.getString("#{num}h"),minute:sysres.getString("#{num}m","durationShortMinutes"),second:sysres.getString("#{num}s"),millisecond:sysres.getString("#{num}m","durationShortMillis"),separator:sysres.getString(" ","separatorShort"),finalSeparator:""};break;case"medium":this.components={year:sysres.getString("1#1 yr|#{num} yrs","durationMediumYears"),month:sysres.getString("1#1 mo|#{num} mos"),week:sysres.getString("1#1 wk|#{num} wks","durationMediumWeeks"),day:sysres.getString("1#1 dy|#{num} dys"),hour:sysres.getString("1#1 hr|#{num} hrs","durationMediumHours"),minute:sysres.getString("1#1 mi|#{num} min"),second:sysres.getString("1#1 se|#{num} sec"),millisecond:sysres.getString("#{num} ms"),separator:sysres.getString(" ","separatorMedium"),finalSeparator:""};break;case"long":this.components={year:sysres.getString("1#1 yr|#{num} yrs"),month:sysres.getString("1#1 mon|#{num} mons"),week:sysres.getString("1#1 wk|#{num} wks"),day:sysres.getString("1#1 day|#{num} days","durationLongDays"),hour:sysres.getString("1#1 hr|#{num} hrs"),minute:sysres.getString("1#1 min|#{num} min"),second:sysres.getString("1#1 sec|#{num} sec"),millisecond:sysres.getString("#{num} ms"),separator:sysres.getString(", ","separatorLong"),finalSeparator:""};break;case"full":this.components={year:sysres.getString("1#1 year|#{num} years"),month:sysres.getString("1#1 month|#{num} months"),week:sysres.getString("1#1 week|#{num} weeks"),day:sysres.getString("1#1 day|#{num} days"),hour:sysres.getString("1#1 hour|#{num} hours"),minute:sysres.getString("1#1 minute|#{num} minutes"),second:sysres.getString("1#1 second|#{num} seconds"),millisecond:sysres.getString("1#1 millisecond|#{num} milliseconds"),separator:sysres.getString(", ","separatorFull"),finalSeparator:sysres.getString(" and ","finalSeparatorFull")};break}if(this.style==="clock"){new DateFmt({locale:this.locale,calendar:"gregorian",type:"time",time:"ms",sync:sync,loadParams:loadParams,useNative:this.useNative,onLoad:ilib.bind(this,function(fmtMS){this.timeFmtMS=fmtMS;new DateFmt({locale:this.locale,calendar:"gregorian",type:"time",time:"hm",sync:sync,loadParams:loadParams,useNative:this.useNative,onLoad:ilib.bind(this,function(fmtHM){this.timeFmtHM=fmtHM;new DateFmt({locale:this.locale,calendar:"gregorian",type:"time",time:"hms",sync:sync,loadParams:loadParams,useNative:this.useNative,onLoad:ilib.bind(this,function(fmtHMS){this.timeFmtHMS=fmtHMS;this.timeFmtHM.template=this.timeFmtHM.template.replace(/hh?/,"H");this.timeFmtHM.templateArr=this.timeFmtHM._tokenize(this.timeFmtHM.template);this.timeFmtHMS.template=this.timeFmtHMS.template.replace(/hh?/,"H");this.timeFmtHMS.templateArr=this.timeFmtHMS._tokenize(this.timeFmtHMS.template);this._init(this.timeFmtHM.locinfo,options&&options.onLoad)})})})})})});return}new LocaleInfo(this.locale,{sync:sync,loadParams:loadParams,onLoad:ilib.bind(this,function(li){this._init(li,options&&options.onLoad)})})})})};DurationFmt.complist={text:["year","month","week","day","hour","minute","second","millisecond"],clock:["year","month","week","day"]};DurationFmt.prototype._mapDigits=function(str){if(this.useNative&&this.digits){return JSUtils.mapString(str.toString(),this.digits)}return str};DurationFmt.prototype._init=function(locinfo,onLoad){var digits;if(typeof this.useNative==="boolean"){if(this.useNative){digits=locinfo.getNativeDigits();if(digits){this.digits=digits}}}else if(locinfo.getDigitsStyle()==="native"){digits=locinfo.getNativeDigits();if(digits){this.useNative=true;this.digits=digits}}if(typeof onLoad==="function"){onLoad(this)}};DurationFmt.prototype.format=function(components){var i,list,temp,fmt,secondlast=true,str="";list=DurationFmt.complist[this.style];for(i=list.length-1;i>=0;i--){if(typeof components[list[i]]!=="undefined"&&components[list[i]]!=0){if(str.length>0){str=(this.length==="full"&&secondlast?this.components.finalSeparator:this.components.separator)+str;secondlast=false}str=this.components[list[i]].formatChoice(components[list[i]],{num:this._mapDigits(components[list[i]])})+str}}if(this.style==="clock"){if(typeof components.hour!=="undefined"){fmt=typeof components.second!=="undefined"?this.timeFmtHMS:this.timeFmtHM}else{fmt=this.timeFmtMS}if(str.length>0){str+=this.components.separator}str+=fmt._formatTemplate(components,fmt.templateArr)}return new IString(str)};DurationFmt.prototype.getLocale=function(){return this.locale};DurationFmt.prototype.getLength=function(){return this.length};DurationFmt.prototype.getStyle=function(){return this.style};module.exports=DurationFmt;