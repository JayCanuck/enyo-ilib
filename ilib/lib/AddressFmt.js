var ilib=require("./ilib.js");var Utils=require("./Utils.js");var JSUtils=require("./JSUtils.js");var Locale=require("./Locale.js");var Address=require("./Address.js");var IString=require("./IString.js");var AddressFmt=function(options){this.sync=true;this.styleName="default";this.loadParams={};this.locale=new Locale();if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(typeof options.sync!=="undefined"){this.sync=options.sync==true}if(options.style){this.styleName=options.style}if(options.loadParams){this.loadParams=options.loadParams}}Utils.loadData({name:"address.json",object:AddressFmt,locale:this.locale,sync:this.sync,loadParams:this.loadParams,callback:ilib.bind(this,function(info){if(!info||JSUtils.isEmpty(info)){Utils.loadData({name:"address.json",object:AddressFmt,locale:new Locale("XX"),sync:this.sync,loadParams:this.loadParams,callback:ilib.bind(this,function(info){this.info=info;this._init();if(options&&typeof options.onLoad==="function"){options.onLoad(this)}})})}else{this.info=info;this._init();if(options&&typeof options.onLoad==="function"){options.onLoad(this)}}})})};AddressFmt.prototype._init=function(){this.style=this.info&&this.info.formats&&this.info.formats[this.styleName];this.style=this.style||this.info&&this.info.formats["default"]||"{streetAddress}\n{locality} {region} {postalCode}\n{country}"};AddressFmt.prototype.format=function(address){var ret,template,other,format;if(!address){return""}if(address.countryCode&&address.countryCode!==this.locale.region&&Locale._isRegionCode(this.locale.region)&&this.locale.region!=="XX"){other=new AddressFmt({locale:new Locale(address.countryCode),style:this.styleName});return other.format(address)}if(typeof this.style==="object"){format=this.style[address.format||"latin"]}else{format=this.style}var params={country:address.country||"",region:address.region||"",locality:address.locality||"",streetAddress:address.streetAddress||"",postalCode:address.postalCode||"",postOffice:address.postOffice||""};template=new IString(format);ret=template.format(params);ret=ret.replace(/[ \t]+/g," ");ret=ret.replace("\n ","\n");ret=ret.replace(" \n","\n");return ret.replace(/\n+/g,"\n").trim()};module.exports=AddressFmt;