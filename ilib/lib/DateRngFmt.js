var ilib=require("./ilib.js");var Utils=require("./Utils.js");var JSUtils=require("./JSUtils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var IDate=require("./IDate.js");var CalendarFactory=require("./CalendarFactory.js");var DateFmt=require("./DateFmt.js");var IString=require("./IString.js");var TimeZone=require("./TimeZone.js");var GregorianCal=require("./GregorianCal.js");var DateRngFmt=function(options){var sync=true;var loadParams=undefined;this.locale=new Locale();this.length="s";if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(options.calendar){this.calName=options.calendar}if(options.length){if(options.length==="short"||options.length==="medium"||options.length==="long"||options.length==="full"){this.length=options.length.charAt(0)}}if(typeof options.sync!=="undefined"){sync=options.sync==true}loadParams=options.loadParams}var opts={};JSUtils.shallowCopy(options,opts);opts.sync=sync;opts.loadParams=loadParams;opts.onLoad=ilib.bind(this,function(fmt){this.dateFmt=fmt;if(fmt){this.locinfo=this.dateFmt.locinfo;this.calName=this.calName||this.locinfo.getCalendar()||"gregorian";this.cal=CalendarFactory({type:this.calName});if(!this.cal){this.cal=new GregorianCal();}this.timeTemplate=this.dateFmt._getFormat(this.dateFmt.formats.time[this.dateFmt.clock],this.dateFmt.timeComponents,this.length)||"hh:mm";this.timeTemplateArr=this.dateFmt._tokenize(this.timeTemplate);if(options&&typeof options.onLoad==="function"){options.onLoad(this)}}});new DateFmt(opts)};DateRngFmt.prototype={getLocale:function(){return this.locale},getCalendar:function(){return this.dateFmt.getCalendar()},getLength:function(){return DateFmt.lenmap[this.length]||""},getTimeZone:function(){return this.dateFmt.getTimeZone()},getClock:function(){return this.dateFmt.getClock()},format:function(start,end){var startRd,endRd,fmt="",yearTemplate,monthTemplate,dayTemplate;if(typeof start!=="object"||!start.getCalendar||start.getCalendar()!==this.calName||typeof end!=="object"||!end.getCalendar||end.getCalendar()!==this.calName){throw"Wrong calendar type"}startRd=start.getRataDie();endRd=end.getRataDie();if(endRd-startRd<3){if(start.year===end.year){if(start.month===end.month){if(start.day===end.day){fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c00",this.length))}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c01",this.length))}}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c02",this.length))}}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c03",this.length))}}else if(endRd-startRd<730){if(start.year===end.year){if(start.month===end.month){fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c10",this.length))}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c11",this.length))}}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c12",this.length))}}else if(endRd-startRd<3650){fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c20",this.length))}else{fmt=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c30",this.length))}yearTemplate=this.dateFmt._tokenize(this.dateFmt._getFormat(this.dateFmt.formats.date,"y",this.length)||"yyyy");monthTemplate=this.dateFmt._tokenize(this.dateFmt._getFormat(this.dateFmt.formats.date,"m",this.length)||"MM");dayTemplate=this.dateFmt._tokenize(this.dateFmt._getFormat(this.dateFmt.formats.date,"d",this.length)||"dd");return fmt.format({sy:this.dateFmt._formatTemplate(start,yearTemplate),sm:this.dateFmt._formatTemplate(start,monthTemplate),sd:this.dateFmt._formatTemplate(start,dayTemplate),st:this.dateFmt._formatTemplate(start,this.timeTemplateArr),ey:this.dateFmt._formatTemplate(end,yearTemplate),em:this.dateFmt._formatTemplate(end,monthTemplate),ed:this.dateFmt._formatTemplate(end,dayTemplate),et:this.dateFmt._formatTemplate(end,this.timeTemplateArr)})}};module.exports=DateRngFmt;