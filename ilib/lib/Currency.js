var ilib=require("./ilib.js");var Utils=require("./Utils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var ResBundle=require("./ResBundle.js");var Currency=function(options){this.sync=true;if(options){if(options.code){this.code=options.code}if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(options.sign){this.sign=options.sign}if(typeof options.sync!=="undefined"){this.sync=options.sync}if(options.loadParams){this.loadParams=options.loadParams}}this.locale=this.locale||new Locale();if(typeof ilib.data.currency==="undefined"){Utils.loadData({name:"currency.json",object:Currency,locale:"-",sync:this.sync,loadParams:this.loadParams,callback:ilib.bind(this,function(currency){ilib.data.currency=currency;this._loadLocinfo(options&&options.onLoad)})})}else{this._loadLocinfo(options&&options.onLoad)}};Currency.getAvailableCurrencies=function(){var ret=[],cur,currencies=new ResBundle({name:"currency"}).getResObj();for(cur in currencies){if(cur&&currencies[cur]){ret.push(cur)}}return ret};Currency.prototype={_loadLocinfo:function(onLoad){new LocaleInfo(this.locale,{onLoad:ilib.bind(this,function(li){var currInfo;this.locinfo=li;if(this.code){currInfo=ilib.data.currency[this.code];if(!currInfo){throw"currency "+this.code+" is unknown"}}else if(this.sign){currInfo=ilib.data.currency[this.sign];if(typeof currInfo!=="undefined"){this.code=this.sign}else{this.code=this.locinfo.getCurrency();currInfo=ilib.data.currency[this.code];if(currInfo.sign!==this.sign){for(var cur in ilib.data.currency){if(cur&&ilib.data.currency[cur]){currInfo=ilib.data.currency[cur];if(currInfo.sign===this.sign){this.code=cur;break}}}}}}if(!currInfo||!this.code){this.code=this.locinfo.getCurrency();currInfo=ilib.data.currency[this.code]}this.name=currInfo.name;this.fractionDigits=currInfo.decimals;this.sign=currInfo.sign;if(typeof onLoad==="function"){onLoad(this)}})})},getCode:function(){return this.code},getFractionDigits:function(){return this.fractionDigits},getSign:function(){return this.sign},getName:function(){return this.name},getLocale:function(){return this.locale}};module.exports=Currency;