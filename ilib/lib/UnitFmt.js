var ilib=require("./ilib.js");var Utils=require("./Utils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var ResBundle=require("./ResBundle.js");var IString=require("./IString.js");var NumFmt=require("./NumFmt.js");var UnitFmt=function(options){var sync=true,loadParams=undefined;this.length="long";this.scale=true;this.measurementType="undefined";this.convert=true;this.locale=new Locale();if(options){if(options.locale){this.locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}if(typeof options.sync==="boolean"){sync=options.sync}if(typeof options.loadParams!=="undefined"){loadParams=options.loadParams}if(options.length){this.length=options.length}if(typeof options.autoScale==="boolean"){this.scale=options.autoScale}if(typeof options.autoConvert==="boolean"){this.convert=options.autoConvert}if(typeof options.useNative==="boolean"){this.useNative=options.useNative}if(options.measurementSystem){this.measurementSystem=options.measurementSystem}if(typeof options.maxFractionDigits==="number"){this.maxFractionDigits=options.maxFractionDigits}if(typeof options.minFractionDigits==="number"){this.minFractionDigits=options.minFractionDigits}this.roundingMode=options.roundingMode}if(!UnitFmt.cache){UnitFmt.cache={}}Utils.loadData({object:UnitFmt,locale:this.locale,name:"unitfmt.json",sync:sync,loadParams:loadParams,callback:ilib.bind(this,function(format){var formatted=format;this.template=formatted["unitfmt"][this.length];new NumFmt({locale:this.locale,useNative:this.useNative,maxFractionDigits:this.maxFractionDigits,minFractionDigits:this.minFractionDigits,roundingMode:this.roundingMode,sync:sync,loadParams:loadParams,onLoad:ilib.bind(this,function(numfmt){this.numFmt=numfmt;if(options&&typeof options.onLoad==="function"){options.onLoad(this)}})})})})};UnitFmt.prototype={getLocale:function(){return this.locale},getTemplate:function(){return this.template},toString:function(){return this.getTemplate()},getScale:function(){return this.scale},getMeasurementSystem:function(){return this.measurementSystem},format:function(measurement){var u=this.convert?measurement.localize(this.locale.getSpec()):measurement;u=this.scale?u.scale(this.measurementSystem):u;var formatted=new IString(this.template[u.getUnit()]);formatted.setLocale(this.locale,true,undefined,undefined);formatted=formatted.formatChoice(u.amount,{n:this.numFmt.format(u.amount)});return formatted.length>0?formatted:u.amount+" "+u.unit}};module.exports=UnitFmt;