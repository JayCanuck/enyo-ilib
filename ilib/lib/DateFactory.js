var ilib=require("./ilib.js");var JSUtils=require("./JSUtils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var JulianDay=require("./JulianDay.js");var CalendarFactory=require("./CalendarFactory.js");var IDate=require("./IDate.js");var GregorianDate=require("./GregorianDate.js");var DateFactory=function(options){var locale,type,cons,sync=true,obj;if(options){if(options.locale){locale=typeof options.locale==="string"?new Locale(options.locale):options.locale}type=options.type||options.calendar;if(typeof options.sync==="boolean"){sync=options.sync}}if(!locale){locale=new Locale();}if(!type){new LocaleInfo(locale,{sync:sync,loadParams:options&&options.loadParams,onLoad:ilib.bind(this,function(info){type=info.getCalendar();obj=DateFactory._init(type,options);if(options&&typeof options.onLoad==="function"){options.onLoad(obj)}})})}else{obj=DateFactory._init(type,options)}return obj};DateFactory._dynMap={coptic:"Coptic",ethiopic:"Ethiopic",gregorian:"Gregorian",han:"Han",hebrew:"Hebrew",islamic:"Islamic",julian:"Julian",persian:"Persian","persian-algo":"PersianAlgo",thaisolar:"ThaiSolar"};DateFactory._dynLoadDate=function(name){if(!IDate._constructors[name]){var entry=DateFactory._dynMap[name];if(entry){IDate._constructors[name]=require("./"+entry+"Date.js")}}return IDate._constructors[name]};DateFactory._init=function(type,options){var cons;if(ilib.isDynCode()){DateFactory._dynLoadDate(type);CalendarFactory._dynLoadCalendar(type)}cons=IDate._constructors[type];return cons&&new cons(options)};DateFactory._dateToIlib=function(inDate,timezone,locale){if(typeof inDate==="undefined"||inDate===null){return inDate}if(inDate instanceof IDate){return inDate}if(JSUtils.isDate(inDate)){return DateFactory({unixtime:inDate.getTime(),timezone:timezone,locale:locale})}if(inDate instanceof JulianDay){return DateFactory({jd:inDate,timezone:timezone,locale:locale})}if(typeof inDate==="number"){return DateFactory({unixtime:inDate,timezone:timezone,locale:locale})}if(typeof inDate==="object"){return DateFactory(inDate)}if(typeof inDate==="string"){inDate=new Date(inDate)}return DateFactory({unixtime:inDate.getTime(),timezone:timezone,locale:locale})};module.exports=DateFactory;