var ilib=require("./ilib.js");var MathUtils=require("./MathUtils.js");var JSUtils=require("./JSUtils.js");var JulianDay=require("./JulianDay.js");var RataDie=function(params){if(params){if(typeof params.date!=="undefined"){var date=params.date;if(!JSUtils.isDate(date)){date=new Date(date)}this._setTime(date.getTime())}else if(typeof params.unixtime!=="undefined"){this._setTime(parseInt(params.unixtime,10))}else if(typeof params.julianday!=="undefined"){this._setJulianDay(parseFloat(params.julianday))}else if(params.year||params.month||params.day||params.hour||params.minute||params.second||params.millisecond||params.parts||params.cycle){this._setDateComponents(params)}else if(typeof params.rd!=="undefined"){this.rd=typeof params.rd==="object"&&params.rd instanceof RataDie?params.rd.rd:params.rd}}if(typeof this.rd==="undefined"){var now=new Date();this._setTime(now.getTime())}};RataDie.gregorianEpoch=1721424.5;RataDie.prototype={epoch:RataDie.gregorianEpoch,_setTime:function(millis){this._setJulianDay(2440587.5+millis/864e5)},_setJulianDay:function(date){var jd=typeof date==="number"?new JulianDay(date):date;this.rd=MathUtils.halfup((jd.getDate()-this.epoch)*864e5)/864e5},_onOrBefore:function(rd,dayOfWeek){return rd-MathUtils.mod(Math.floor(rd)-dayOfWeek-2,7)},onOrBefore:function(dayOfWeek,offset){offset=offset||0;return this._onOrBefore(this.rd+offset,dayOfWeek)-offset},onOrAfter:function(dayOfWeek,offset){offset=offset||0;return this._onOrBefore(this.rd+6+offset,dayOfWeek)-offset},before:function(dayOfWeek,offset){offset=offset||0;return this._onOrBefore(this.rd-1+offset,dayOfWeek)-offset},after:function(dayOfWeek,offset){offset=offset||0;return this._onOrBefore(this.rd+7+offset,dayOfWeek)-offset},getTime:function(){var jd=this.getJulianDay();if(jd<2440587.5||jd>2465442.634803241){return-1}return Math.round((jd-2440587.5)*864e5)},getTimeExtended:function(){var jd=this.getJulianDay();if(jd<-97559412.5||jd>102440587.5){return NaN}return Math.round((jd-2440587.5)*864e5)},getJulianDay:function(){return this.rd+this.epoch},getRataDie:function(){return this.rd}};module.exports=RataDie;